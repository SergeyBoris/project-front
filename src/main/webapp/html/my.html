<html>
<head>

    <title>RPG</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.4.3/luxon.min.js"></script>

    <link href="/css/my.css" rel="stylesheet">
</head>
<body>
<h1>RPG admin panel</h1>
<h2>Account list:</h2>
<div id="dropdownlist">Count per page:</div>

<table id="table" border="1">
    <thead id="tHead">
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
    </tr>
    </thead>
    <tbody id="tBody">

    </tbody>
</table>
<div id="navigation">
    Pages:
    <!--        <button>1</button>-->

</div>

<script>
    let accountCount;
    let pageNumber;
    let pageSize;
    let chosenOption;


    $.ajax({
        type: "GET",
        url: "/rest/players",
        success: function () {
            updateTable(0,3)
        }
    });


    $.ajax({
        type: "GET",
        url: "/rest/players/count",

        success: function (msg) {
            accountCount = msg;
        }
    });
    let select = document.createElement("select");
    let options = ["3", "5", "10", "20"];
    for (let i = 0; i < options.length; i++) {
        let option = document.createElement("option");
        option.value = options[i];
        option.textContent = options[i];
        select.appendChild(option);
    }
    let dropdownlist = document.getElementById("dropdownlist");
    dropdownlist.appendChild(select);

    select.addEventListener("change", function () {
        const selectedValue = select.value;
        dropdownAction(selectedValue);
    })

    function dropdownAction(value) {
        switch (value) {
            case "3":
                updateTable(0, 3)
                break;
            case "5":
                updateTable(0, 5)
                break;
            case "10":
                updateTable(0, 10)
                break;
            case "20":
                updateTable(0, 20)
                break;
            default:
                alert("default");
        }
    }

    function updateNavigation(pageSize) {
        const nav = document.getElementById("navigation")
        nav.innerHTML = "";
        let btnCount = Math.ceil(accountCount / pageSize)
        for (let i = 0; i < btnCount; i++) {
            let btn = document.createElement("button")
            btn.textContent = i + 1;
            btn.dataset.pageNumber = i;
            btn.addEventListener("click", function () {
                btn.classList.add("active");
                updateTable(i, pageSize);
            });
            nav.appendChild(btn);
        }

    }

    function updateTable(pageNumber, pageSize) {
        const tab = document.getElementById("tBody");
        tab.innerHTML = null;
        $.ajax({
            type: "GET",
            url: `/rest/players?pageNumber=${pageNumber}&pageSize=${pageSize}`,
            success: function (message) {
                const tab = document.getElementById("tBody");
                const {DateTime} = luxon;

                for (let i = 0; i < message.length; i++) {

                    let date = DateTime.fromMillis(message[i].birthday);
                    let formattedDate = date.toFormat('M/d/yyyy');
                    let row = document.createElement("tr");
                    row.innerHTML = `<td>${message[i].id}</td>
                                <td>${message[i].name}</td>
                                <td>${message[i].title}</td>
                                <td>${message[i].race}</td>
                                <td>${message[i].profession}</td>
                                <td>${message[i].level}</td>
                                <td>${formattedDate}</td>
                                <td>${message[i].banned}</td>`;
                    tab.appendChild(row);
                }
                updateNavigation(pageSize)
            }
        });


    }


</script>
</body>
</html>